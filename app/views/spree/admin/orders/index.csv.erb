<%- if params[:template] == 'addresses' -%>
  <%- headers = ['[quickid]','[sender]','[receiver]','[category1text]','[category2text]','[name]','[address1]','[address2]','[zipcode]','[city]','[state]','[country]','[contact]','[email]','[phone]','[sms]','[senderref]'] -%>
<%- elsif params[:template] == 'orders' -%>
  <%- headers = ['[SenderQuickID]','[OrderNo]','[Name]','[Address1]','[Address2]','[Zipcode]','[City]','[State]','[Country]','[Email]','[Phone]','[Reference]','[Contents]','[NoOfPackages]','[Weight]'] -%>
<%- end -%>
<%- ordersToExport = @search.result(distinct: true) -%>
<%= CSV.generate({col_sep: "\t", encoding: Spree::UnifaunExport::Config[:encoding]}) do |csv| =%>
  <%- csv << headers -%>
  <%- ordersToExport.each do |order| -%>
    <%- if params[:template] == 'addresses' -%>
      <%- csv << [order.email,
                 'N',
                 'Y',
                 order.shipments.first.shipping_method.admin_name,
                 order.quantity,
                 order.ship_address.firstname + ' ' + order.ship_address.lastname,
                 order.ship_address.address1,
                 order.ship_address.address2 != '' ? order.ship_address.address2 : nil,
                 order.ship_address.zipcode,
                 order.ship_address.city,
                 order.ship_address.state ? order.ship_address.state.abbr : nil,
                 order.ship_address.country.iso,
                 order.ship_address.firstname + ' ' + order.ship_address.lastname,
                 order.email,
                 order.ship_address.phone,
                 order.ship_address.phone,
                 order.number
               ]
     -%>
    <%- elsif params[:template] == 'orders' -%>
      <%- csv << [Spree::UnifaunExport::Config[:sender_quick_id],
                 order.number,
                 order.ship_address.firstname + ' ' + order.ship_address.lastname,
                 order.ship_address.address1,
                 order.ship_address.address2 != '' ? order.ship_address.address2 : nil,
                 order.ship_address.zipcode,
                 order.ship_address.city,
                 order.ship_address.state ? order.ship_address.state.abbr : nil,
                 order.ship_address.country.iso,
                 order.email,
                 order.ship_address.phone,
                 order.shipments.first.unifaun_reference,
                 Spree::UnifaunExport::Config[:contents],
                 1,
                 order.shipments.first.total_weight
               ]
    -%>
    <%- end -%>
  <%- end -%>
<%- end .html_safe-%>
